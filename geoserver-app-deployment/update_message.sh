#!/bin/bash
grep "ausseabed-geoserver:[0-9]" terragrunt.hcl | sed "s/.*:\([0-9.]\+\).*/\1/" | sort | uniq | awk -F "." '{printf("run:\n\ngit checkout master\ngit pull\ngit tag prod/publish/%d.%d.%d\ngit push origin prod/publish/%d.%d.%d\n\nthen update ausseabed-aws-foundation/geoserver-app-deployment/terragrunt.hcl in \ngit clone git@github.com:ausseabed/ausseabed-aws-foundation.git\nwith\ngit checkout master\ngit pull\ngit checkout -b warehouse-rel/%d.%d.%d\nsed -i \"s/\\(ausseabed-geoserver:\\)%d.%d.%d/\\1%d.%d.%d/\" terragrunt.hcl\ngit add terragrunt.hcl\ngit commit -m \"Update warehouse version\"\ngit push origin warehouse-rel/%d.%d.%d\n\nthen run:\n\ngit checkout master\ngit pull\ngit tag prod/deploy/%d.%d.%d\ngit push origin prod/deploy/%d.%d.%d\n\n",$1,$2,$3+1,$1,$2,$3+1,$1,$2,$3+1,$1,$2,$3,$1,$2,$3+1, $1,$2,$3+1,$1,$2,$3+1,$1,$2,$3+1)}'

